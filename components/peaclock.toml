name = "peaclock"
from = "base"

# https://github.com/octobanana/peaclock/releases
version = "0.4.3"

devDependencies = [ "clone", "build-essential" ]

build = """
# manually install dependencies
add-apt-repository ppa:ubuntu-toolchain-r/test
apt-get update -q
apt-get install -y --no-install-recommends --auto-remove \
  cmake libpthread-stubs0-dev libicu-dev gcc-9 g++-9

clone --https --shallow --tag '{{VERSION}}' https://github.com/octobanana/peaclock
cd /root/src/github.com/octobanana/peaclock

# build/install
./RUNME.sh build --release -- -DCMAKE_CXX_COMPILER=/usr/bin/g++-9
./RUNME.sh install --release

# cleanup
rm -rf /root/src
apt purge -y \
  cmake libpthread-stubs0-dev libicu-dev gcc-9 g++-9
apt autoremove -y
apt-get -q clean
"""

exports = [
  "/etc/perl/",
  "/lib/x86_64-linux-gnu/libgcc_s.so.1",
  "/usr/lib/x86_64-linux-gnu/libstdc++.so.6",
  "/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.28",
  "/usr/local/bin/peaclock",
  "/usr/share/gcc-10/",
  "/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.28-gdb.py",
  "/var/cache/ldconfig/aux-cache",
]
